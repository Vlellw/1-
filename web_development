from flask import Flask, render_template, request

app = Flask(__name__)

# Допустимые расширения файлов
ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif'}

# Проверка допустимости файла по его расширению
def allowed_file(filename):
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS

# Маршрут для главной страницы
@app.route('/', methods=['GET', 'POST'])
def index():
    if request.method == 'POST':
        if 'file' not in request.files:
            return render_template('index.html', images=None, error='Нет файла для загрузки. Пожалуйста, выберите файл.')

        file = request.files['file']

        if file and allowed_file(file.filename):
            # Получаем URL файла без сохранения на диск
            image_data = file.read()
            images = [f"data:image/{file.filename.rsplit('.', 1)[1].lower()};base64," + image_data.encode('base64').decode('utf-8')]
            return render_template('index.html', images=images)

        return render_template('index.html', images=None, error='Недопустимый файл. Пожалуйста, загрузите изображение в формате PNG, JPG, JPEG или GIF.')

    return render_template('index.html', images=None)

if __name__ == '__main__':
    app.run(debug=True)
